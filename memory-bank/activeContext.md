# 当前工作上下文

## 当前任务
阶段 2 核心功能已基本完成：
1. ✅ 修复 Partner 数据模型 level 枚举值问题 [2025-12-15]
2. ✅ 创建热词服务（支持从数据库动态加载） [2025-12-15]
3. ✅ 实现 NLU 意图识别模块（规则+AI混合） [2025-12-15]
4. ✅ 实现 NLU 实体抽取模块（商品/顾客/数量/价格） [2025-12-15]
5. ✅ 实现 ASR 抽象层（Whisper/阿里云 Paraformer） [2025-12-15]
6. ✅ 实现 AI Provider 抽象层（多模型切换） [2025-12-15]
7. ✅ 实现定价引擎（规则匹配+历史学习） [2025-12-15]
8. ⏳ 对话管理模块
9. ⏳ 交易记录服务
10. ⏳ 后台管理界面

## 最近变更 [2025-12-15]
- 🚀 完成 NLU 模块（src/nlu/）
  - 意图分类器：支持6种意图类型
  - 实体抽取器：商品、顾客、数量、价格
  - AI Provider：阿里云通义千问适配
- 🚀 完成 ASR 抽象层（src/voice/）
  - 支持 Whisper（本地）和阿里云 Paraformer（方言）
  - 热词自动加载和刷新
- 🚀 完成定价引擎（src/pricing/）
  - 4级规则优先级：全局、分类、客户等级、特殊
  - 历史价格学习
  - 语音播报文本生成

## 关键决策
- NLU：规则优先 + AI 兜底（置信度<0.6时调用 AI）
- ASR：默认使用阿里云 paraformer-realtime-v2（支持方言）
- AI：使用阿里云 tongyi-intent-detect-v3（意图识别专用）
- 热词从数据库动态加载
- 定价引擎支持 4 级规则优先级

## 验收测试
- 脚本位置：scripts/verify-modules.ts
- 运行方式：npx ts-node scripts/verify-modules.ts

## 环境配置要求
- DASHSCOPE_API_KEY：阿里云百炼 API Key
