# “无数据自动记忆”小店 AI 报价助手需求文档

> 版本：v1.0  
> 适用场景：夫妻店 / 小杂货铺 / 小型便利店  
> 目标：解放女店主，让男店主在不记价格的前提下也能独立完成人情化报价与进货核价。

---

## 1. 背景与目标

### 1.1 背景

- 店铺为典型夫妻店：
  - **女店主**负责进货、定价、毛利控制，熟记大量商品价格和不同顾客的加价/优惠习惯。
  - **男店主**不记价格，绝大部分报价都依赖女店主“报个价”或“脑子里的价格表”。
- 现状问题：
  - 严重路径依赖：女店主必须几乎 24 小时待命，即便生病或不在店里，仍需接电话/语音为男店主报价格。
  - 商品众多 + 顾客/供货商众多，难以通过一次性手工录入完成完整的商品库、客户库与定价系统。
  - 传统系统要求完整数据录入，超出实际使用者的学习与维护能力。

### 1.2 系统目标

1. **即使女店主不在场，男店主也可以独立完成报价和进货核价。**
2. **无需前期大量录入商品与顾客数据**，系统通过“用一次、记一点”，自动积累记忆。
3. 把女店主大脑中的“加价策略”“人情价”“抹零习惯”逐步迁移为系统可执行规则。
4. 系统越用越聪明，商品与顾客信息逐步结构化，提升效率与一致性。
5. 保持使用门槛低：尽量用语音交互，后台维护控制在女店主有空时的“碎片时间”内完成。

---

## 2. 角色定义

- **男店主（主要语音使用者）**
  - 核心行为：语音询价、语音确认价格、简单纠错。
- **女店主（定价策略与知识的主要提供者）**
  - 核心行为：配置加价策略、在空闲时做“记忆校对/确认”、检查利润情况。
- **系统管理员 / 技术人员（可选）**
  - 部署、维护系统与模型配置。

---

## 3. 使用场景与用户故事

### 3.1 零售报价场景

**用户故事：**  
男店主不会记具体价格，但记得顾客名字与大致“关系”。

- 男店主对设备说：  
  > “小店小店，张三两瓶可乐，一包纸巾，这次卖他多少钱合适？”
- 系统行为：
  1. 通过语音识别转换为文本。
  2. 识别意图为“零售报价”，抽取：
     - 顾客称呼：张三
     - 商品与数量：可乐 ×2，纸巾 ×1
  3. 从历史记忆与规则中获取：
     - 张三的顾客类型（熟客/普通…）
     - 张三以往购买“可乐”“纸巾”的成交价记录
  4. 给出推荐售价（含抹零建议），并通过语音 + 屏幕显示：
     > “按以前的习惯，可乐 3 元一瓶，纸巾 5 元一包，一共 11 元，要不要照这个算？”
  5. 男店主如说“好，就 11 元”，系统记录本次交易为新的记忆。

### 3.2 进货核价 / 售价建议场景

**用户故事：**  
男店主记不清某件商品的进货价与合适售价。

- 男店主说：  
  > “小店小店，老李那边两箱可乐现在进价多少？平时我卖多少比较合适？”
- 系统行为：
  1. 识别意图“进货核价/售价建议”。
  2. 识别供货商“老李”与商品“可乐”。
  3. 查找历史进货记录与售价记录，输出：
     - 与老李合作的典型进货价区间
     - 店内零售价区间与平均毛利
  4. 用语音提示男店主：
     > “老李这边可乐最近进货价大约 2 元一瓶，你平时零售价 3 元左右，毛利约 1 元每瓶。”

### 3.3 无数据启动 / 第一次使用场景

**用户故事：**  
系统首次使用，对任何顾客、商品都没有结构化记录。

- 男店主说：  
  > “小店小店，张三两瓶可乐，一包纸巾，我这次卖他多少合适？”
- 系统行为：
  1. ASR + NLU 提取顾客称呼和商品名，发现均为**新实体**。
  2. 启动简化问答：
     - “张三是熟客还是普通顾客？你可以说‘熟客’或者‘普通’。”
     - “这次你打算可乐卖几块，纸巾卖几块？”
  3. 男店主回答：
     - “熟客。”
     - “可乐 3 块一瓶，纸 5 块。”
  4. 系统：
     - 当前报价直接按用户输入计算。
     - 将“张三”“可乐”“纸巾”作为候选记忆存入“原始交易日志层”和“候选记忆层”。
  5. 后续系统即开始“从这一次交易学起”。

### 3.4 打烊后记忆复盘（女店主后台校对）

**用户故事：**  
女店主晚上有空，希望快速看一眼今天系统“新学到的东西”，顺便修正。

- 系统后台展示“今日复盘界面”：
  1. 今日新增/高频商品叫法：
     - “可乐 / 可口可乐 / 可乐一瓶”
     - “心相印 / 抽纸 / 纸巾”
  2. 今日活跃顾客称呼：
     - “张三（今日 3 单）”
     - “老李（供货商，进货 1 单）”
- 女店主可做的操作：
  - 为商品候选统一一个正式名称：  
    - 如将“可乐 / 可口可乐 / 可乐一瓶”统一为“可口可乐瓶装 500ml”。
  - 为顾客设置类型标签：  
    - “张三” → 熟客  
    - “老李” → 供货商
  - （可选）补录一些核心商品的进货成本价。

---

## 4. 功能需求

### 4.1 语音交互模块

#### 4.1.1 语音唤醒

- 支持配置唤醒词（如“小店小店”）。
- 唤醒后进入“语音监听状态”，直到识别到结束语句或超时时间。

#### 4.1.2 语音识别（ASR）

- 将男店主的自然语音转为中文文本。
- 要求：
  - 针对普通话优化，可扩展适应方言口音。
  - 能较好识别常见品牌名、商品名（通过自定义热词/词表增强）。

#### 4.1.3 语音合成（TTS）

- 将系统输出的报价、问题、提示转为语音播放。
- 要求语音清晰、自然，语速适中，可配置男女声。

### 4.2 自然语言理解（NLU）与对话管理

#### 4.2.1 意图识别

最少需要识别以下意图：

- 零售报价（retail_quote）
- 进货核价/售价建议（purchase_price_check）
- 单品价格查询（single_item_query）
- 纠错/改价（price_correction）
- 简单确认/否定（confirm/deny）

#### 4.2.2 实体抽取

- 顾客/供货商称呼识别：如“张三”“老李”“隔壁小卖部”等。
- 商品名称识别：如“可乐”“蓝月亮洗衣液”“心相印纸巾”。
- 数量与单位：如“2 瓶”“3 包”“1 箱”等。
- 简单价格表达：如“3 块”“5 块 5”。

#### 4.2.3 对话管理

- 支持多轮交互：
  - 不确定时可追问（如：“你这次打算卖几块？”）。
  - 记住本轮对话上下文（顾客、商品）直到本轮交易结束。
- 对于置信度低的解析结果，优先通过一句简短追问确认。

### 4.3 定价引擎（加价策略 + 历史学习）

#### 4.3.1 基础能力

- 根据顾客类型、商品类型、历史成交记录，给出：
  - 推荐单价（每个商品）
  - 推荐总价
  - 抹零建议（如从 11.2 元抹到 11 元）

#### 4.3.2 加价规则体系（支持逐步完善）

规则分层级，优先级从高到低：

1. **顾客 + 商品的专用规则**  
   - 示例：“张三买可乐统一 3 元一瓶”。
2. **顾客类型规则**  
   - 普通顾客：成本 × 1.4  
   - 熟客：成本 × 1.25  
   - 小商户：成本 × 1.15
3. **商品类别规则**  
   - 饮料：成本 × 1.2  
   - 纸品：成本 × 1.25 等。
4. **全店默认规则**  
   - 如：成本 × 1.3 或基于历史平均毛利。

#### 4.3.3 历史学习机制

- 在缺乏成本价和规则时，系统可仅基于**历史成交价**给出“经验价”：
  - 针对某顾客+商品，记录过去多次成交价，计算“常用价格”。
  - 针对某商品的整体客群记录，计算平均零售价。

- 每次男店主通过语音改价时：
  - 系统更新该顾客+商品组合的价格分布。
  - 可根据频次与稳定性自动生成候选“专用规则”。

### 4.4 “无数据自动记忆”机制

#### 4.4.1 三层记忆结构

1. **原始交易日志层**
   - 记录每笔交易原始信息：时间、原始语音文本、解析结果、最终成交价等。
2. **候选记忆层（系统自动挖掘）**
   - 从交易日志中自动提取高频顾客称呼、高频商品叫法及其价格分布。
   - 并进行简单聚类（如把“可乐”“可口可乐”归为一类候选）。
3. **结构化记忆层（确认后生效）**
   - 女店主在“复盘界面”中确认后，被提升为正式的：
     - 商品记录（带统一名称、可选条码、类别、成本）
     - 顾客记录（带类型标签：熟客/普通/小商户/供货商）
     - 特定规则记录（顾客+商品专用价等）

#### 4.4.2 自动发现商品

- 定期（如每日/每周）从日志中统计：
  - 出现次数达到一定阈值的商品词。
- 利用文本相似度/聚类对候选商品进行合并。

- 在后台展示：
  - “高频商品候选列表”
  - 每个候选展示：
    - 出现的不同叫法（如“可乐”“可口可乐”）
    - 最近一段时间的典型成交价

- 女店主操作：
  - 为候选统一“正式名称”（必要/推荐字段）。
  - 可选：设置类别、单位、成本价。

#### 4.4.3 自动发现顾客

- 类似商品，对顾客称呼进行统计与聚合：
  - 高频顾客称呼、消费总额、来访频次。
- 界面展示：
  - 今日/本周活跃顾客列表。
- 女店主操作：
  - 指定顾客类型（熟客/普通/小商户/供货商）。
  - 可选备注信息，如“附近饭店老板”“楼上理发店”等。

### 4.5 纠错与人工校准

#### 4.5.1 营业中纠错

- 男店主可在报价后通过语音简单改价：
  - “按 11 块算。”
  - “贵了 2 块。”
- 系统行为：
  - 更新当前单的成交价。
  - 写入交易记录用于后续学习（但不会立即变更全局规则）。

#### 4.5.2 后台规则调整

- 女店主可在后台查看：
  - 哪些商品/顾客的实际成交价经常偏离系统推荐价。
- 可针对这些组合：
  - 手动设定固定价。
  - 或调整顾客/商品类别的加价公式。

### 4.6 后台管理与复盘界面

#### 4.6.1 今日复盘页

- 展示：
  - 今日新增的高频商品叫法（带简单合并建议）。
  - 今日常见顾客称呼与消费情况。
  - 今日系统报价与实际成交价差异较大的交易。

- 操作：
  - 商品：统一名称、设置类别、设置成本。
  - 顾客：设置类型、合并重复称呼。
  - 规则：一键将“稳定的顾客+商品价格”生成为专用规则。

#### 4.6.2 统计报表（可作为后期增强）

- 按商品查看毛利情况。
- 按顾客类型查看整体利润贡献。
- 识别“经常被砍价”的商品。

---

## 5. 数据模型（简要）

### 5.1 商品表 `products`

| 字段名        | 类型       | 说明                         |
|---------------|------------|------------------------------|
| id            | bigint PK  | 主键                         |
| name          | varchar    | 正式商品名称                 |
| aliases       | json       | 商品别名列表                 |
| barcode       | varchar    | 条码（可选）                 |
| category      | varchar    | 商品类别（饮料/纸品等）      |
| unit          | varchar    | 单位（瓶/包/箱等）          |
| base_cost     | decimal    | 标准进货成本（可为空）       |
| is_active     | bool       | 是否启用/在售                |

### 5.2 顾客/供货商表 `partners`

| 字段名        | 类型       | 说明                                  |
|---------------|------------|---------------------------------------|
| id            | bigint PK  | 主键                                  |
| name          | varchar    | 称呼（张三/老李/隔壁小卖部等）        |
| type          | enum       | customer/supplier                     |
| level         | enum       | 普通/熟客/小商户/大客户等             |
| note          | varchar    | 备注（如“楼上理发店”）               |
| created_at    | datetime   | 创建时间                              |

### 5.3 定价规则表 `pricing_rules`

| 字段名       | 类型       | 说明                                                         |
|--------------|------------|--------------------------------------------------------------|
| id           | bigint PK  | 主键                                                         |
| scope_type   | enum       | 全店/global、类别/category、顾客类型/level、专用/special   |
| scope_value  | varchar    | 具体作用对象（如“饮料”“熟客”“张三+可乐”）                 |
| formula      | varchar    | 表达式（如 `cost * 1.2` 或 `3.0` 固定价）                   |
| rounding     | varchar    | 抹零规则（如“floor_to_1_yuan”）                             |
| priority     | int        | 优先级，数字越大越优先                                      |
| enabled      | bool       | 是否启用                                                     |

### 5.4 交易记录表 `transactions`

| 字段名        | 类型       | 说明                                              |
|---------------|------------|---------------------------------------------------|
| id            | bigint PK  | 主键                                              |
| partner_id    | bigint FK  | 顾客/供货商 ID（可为空，若无法匹配）              |
| timestamp     | datetime   | 交易时间                                          |
| items_json    | json       | [{product_name, qty, unit, price}]               |
| total_price   | decimal    | 实际成交总价                                      |
| total_cost    | decimal    | 系统估计成本总价（有成本数据时）                  |
| raw_text      | text       | 原始语音识别文本                                  |
| intent        | varchar    | 本次识别意图                                      |

### 5.5 候选记忆表（商品/顾客候选）

可以根据实现自由设计，如：

- `candidate_products`：记录高频商品词、出现次数、关联价格分布。  
- `candidate_partners`：记录高频顾客称呼、来访频次、消费金额等。

---

## 6. 业务流程（时序）

### 6.1 零售报价完整流程

1. 男店主唤醒系统并发起语音请求。  
2. ASR 转写为文本。  
3. NLU 解析意图与实体（顾客、商品、数量）。  
4. 后端进行顾客匹配：
   - 若置信度高 → 使用对应 partner 记录。
   - 若置信度低 → 暂以临时称呼处理，记录于候选记忆层。
5. 后端进行商品匹配：
   - 优先匹配已有 products。
   - 不存在时记录为候选商品，并依据历史同名记录估价（若有）。
6. 定价引擎：
   - 根据规则体系和历史成交记录计算推荐价。
   - 若规则与历史均不足以给出合理建议，则向男店主发起简短询问（如“你打算卖几块？”）。
7. 前端展示并通过 TTS 播报报价。  
8. 男店主可以：
   - 直接接受报价。  
   - 通过语音修改总价/单价。  
9. 系统记录最终成交记录，更新记忆。

### 6.2 “无数据启动”时的特殊处理

- 若第一次遇到的顾客和商品：
  - 默认只做最简单的询问（顾客类型、这次你想卖的价格）。
  - 尽量不增加男店主负担。
- 后续多次遇到相同称呼/商品时：
  - 使用“历史价格”作为推荐值，减少再询问次数。

### 6.3 打烊后复盘流程

1. 女店主打开后台管理 app/页面。  
2. 进入“今日复盘”模块：
   - 查看高频商品候选、顾客候选、偏差较大的交易记录。  
3. 根据时间与精力，进行少量操作：
   - 商品合并与命名。
   - 顾客类型设置。
   - 对某些稳定的价格模式一键生成规则。  
4. 保存后，更新结构化记忆层，后续报价更稳定。

---

## 7. 非功能需求

### 7.1 易用性

- 前台（男店主端）尽量**无学习成本**：
  - 绝大部分操作通过说话完成。
  - 避免在繁忙时段要求复杂输入。
- 后台（女店主端）操作时间控制在**每天 3–10 分钟**即可获得明显收益。

### 7.2 性能

- 语音识别和报价响应时间尽可能控制在**1–3 秒**内。

### 7.3 可用性与稳定性

- 在网络条件一般的情况下保持可用：
  - 可考虑在本地缓存近期商品与顾客信息。

### 7.4 数据安全

- 顾客、成本、售价等数据仅店主使用，不对外。  
- 提供定期备份与数据导出能力。

---

## 8. 实施与迭代建议

### 8.1 阶段 1：MVP 原型

- 实现基础语音报价闭环：
  - 语音 → 文字 → 解析 → 基于简单规则的报价 → 记录交易。  
- 支持“用一次记一次”，但无需完整后台管理。

### 8.2 阶段 2：自动记忆 + 复盘界面

- 增加候选记忆层、商品/顾客自动发现。  
- 提供“今日复盘”后台界面，让女店主开始做轻量校对。

### 8.3 阶段 3：智能优化

- 基于交易数据做：
  - 自动规则推荐（顾客+商品专价）。  
  - 毛利分析与风险提示。  
- 进一步提升体验与决策质量。

---

## 9. 附录：关键设计原则

1. **不上来要求“把所有商品录进去”**，一切围绕“边用边记”。  
2. **语音是第一入口，表单维护只是辅助**。  
3. **任何“多问一句话”的设计都要换来明显收益**（例如之后不再问同类问题）。  
4. **错误易改，修正即学习**，而不是让店主怕“用错一次就系统乱了”。
