# å°åº—æŠ¥ä»·åŠ©æ‰‹ - å®¢æˆ·ç«¯

è·¨å¹³å°å®¢æˆ·ç«¯åº”ç”¨ï¼ŒåŒ…å«å¾®ä¿¡å°ç¨‹åºã€H5 Web åº”ç”¨å’Œ Android APPã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
client/
â”œâ”€â”€ shared/                 # å…±äº«ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ api/               # API è°ƒç”¨å°è£…
â”‚   â”œâ”€â”€ types/             # TypeScript ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ utils/             # é€šç”¨å·¥å…·å‡½æ•°
â”œâ”€â”€ platform/              # å¹³å°å…¼å®¹å±‚
â”‚   â”œâ”€â”€ interface.ts       # å¹³å°æ¥å£å®šä¹‰
â”‚   â”œâ”€â”€ h5-adapter.ts      # H5/WebView é€‚é…å™¨
â”‚   â””â”€â”€ index.ts           # å¹³å°æ£€æµ‹ä¸åˆå§‹åŒ–
â”œâ”€â”€ h5/                    # H5 Web åº”ç”¨ (Vue 3)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ views/         # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ components/    # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ stores/        # Pinia çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ styles/        # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.ts
â””â”€â”€ android/               # Android APP
    â”œâ”€â”€ app/
    â”‚   â””â”€â”€ src/main/
    â”‚       â”œâ”€â”€ java/      # Kotlin æºç 
    â”‚       â””â”€â”€ res/       # èµ„æºæ–‡ä»¶
    â””â”€â”€ build.gradle
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä¸šåŠ¡é€»è¾‘å±‚ (shared/)                     â”‚
â”‚  API è°ƒç”¨ã€ç±»å‹å®šä¹‰ã€å·¥å…·å‡½æ•° - è·¨å¹³å°å¤ç”¨                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¹³å°å…¼å®¹å±‚ (platform/)                   â”‚
â”‚  ç»Ÿä¸€æ¥å£å®šä¹‰ã€å„å¹³å°é€‚é…å™¨å®ç°                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å°ç¨‹åºç«¯         â”‚    H5 Web ç«¯      â”‚   Android APP ç«¯     â”‚
â”‚   (miniprogram/)  â”‚    (h5/)          â”‚   (android/)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### H5 å¼€å‘

```bash
cd client/h5

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build
```

### Android å¼€å‘

1. ä½¿ç”¨ Android Studio æ‰“å¼€ `client/android` ç›®å½•
2. åŒæ­¥ Gradle
3. è¿è¡Œåˆ°æ¨¡æ‹Ÿå™¨æˆ–çœŸæœº

#### å¼€å‘æ¨¡å¼

å¼€å‘æ¨¡å¼ä¸‹ï¼ŒAndroid APP ä¼šåŠ è½½æœ¬åœ° H5 å¼€å‘æœåŠ¡å™¨ï¼š

```bash
# 1. å…ˆå¯åŠ¨ H5 å¼€å‘æœåŠ¡å™¨
cd client/h5
npm run dev

# 2. ç„¶åè¿è¡Œ Android APP
# åœ¨ Android Studio ä¸­ç‚¹å‡» Run
```

#### ç”Ÿäº§æ¨¡å¼

ç”Ÿäº§æ¨¡å¼ä¸‹ï¼ŒH5 èµ„æºä¼šè¢«æ‰“åŒ…åˆ° APK çš„ assets ç›®å½•ï¼š

```bash
# 1. æ„å»º H5
cd client/h5
npm run build

# 2. å¤åˆ¶æ„å»ºäº§ç‰©åˆ° Android assets
cp -r dist/* ../android/app/src/main/assets/h5/

# 3. æ„å»º APK
cd ../android
./gradlew assembleRelease
```

## ğŸ”Œ å¹³å°å…¼å®¹å±‚

### æ¥å£å®šä¹‰

å¹³å°å…¼å®¹å±‚å®šä¹‰äº†ç»Ÿä¸€çš„æ¥å£ï¼ŒåŒ…æ‹¬ï¼š

- **IRecorderService** - å½•éŸ³æœåŠ¡
- **IAudioService** - éŸ³é¢‘æ’­æ”¾æœåŠ¡
- **IVibrateService** - æŒ¯åŠ¨æœåŠ¡
- **IToastService** - æç¤ºæœåŠ¡
- **IStorageService** - å­˜å‚¨æœåŠ¡

### ä½¿ç”¨ç¤ºä¾‹

```typescript
import { getPlatformAdapter } from '@platform/index';

// è·å–å¹³å°é€‚é…å™¨
const adapter = getPlatformAdapter();

// ä½¿ç”¨å½•éŸ³æœåŠ¡
await adapter.recorder.start();
const result = await adapter.recorder.stop();

// ä½¿ç”¨æç¤ºæœåŠ¡
adapter.toast.success('æ“ä½œæˆåŠŸ');

// ä½¿ç”¨å­˜å‚¨æœåŠ¡
await adapter.storage.set('key', 'value');
```

### Android JSBridge

Android åŸç”ŸåŠŸèƒ½é€šè¿‡ JSBridge æš´éœ²ç»™ H5ï¼š

```kotlin
// Kotlin ç«¯
@JavascriptInterface
fun startRecording(): Boolean { ... }

// JavaScript ç«¯
window.AndroidBridge.startRecording()
```

## ğŸ“± åŠŸèƒ½ç‰¹æ€§

### è¯­éŸ³æŠ¥ä»·
- æŒ‰ä½å½•éŸ³ï¼Œæ¾å¼€è¯†åˆ«
- æ”¯æŒ Web MediaRecorderï¼ˆH5ï¼‰
- æ”¯æŒ Android MediaRecorderï¼ˆAPPï¼‰
- è‡ªåŠ¨è¯­éŸ³æ’­æŠ¥å›å¤

### äº¤æ˜“ç®¡ç†
- æŸ¥çœ‹äº¤æ˜“è®°å½•
- æŒ‰æ—¥æœŸç­›é€‰
- äº¤æ˜“ç»Ÿè®¡

### è®¾ç½®
- æœåŠ¡å™¨åœ°å€é…ç½®
- è¯­éŸ³åŠŸèƒ½å¼€å…³
- è‡ªåŠ¨æ’­æ”¾è®¾ç½®

## ğŸ”§ é…ç½®

### åç«¯ API åœ°å€

å¼€å‘ç¯å¢ƒåœ¨ `vite.config.ts` ä¸­é…ç½®ä»£ç†ï¼š

```typescript
proxy: {
  '/api': {
    target: 'http://localhost:3001',
    changeOrigin: true
  }
}
```

ç”Ÿäº§ç¯å¢ƒåœ¨åº”ç”¨è®¾ç½®ä¸­é…ç½®ã€‚

### Android å¼€å‘åœ°å€

`app/build.gradle` ä¸­é…ç½®ï¼š

```gradle
buildTypes {
    debug {
        // 10.0.2.2 æ˜¯ Android æ¨¡æ‹Ÿå™¨è®¿é—®å®¿ä¸»æœºçš„åœ°å€
        buildConfigField "String", "H5_URL", '"http://10.0.2.2:5173"'
    }
}
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å½•éŸ³æƒé™**ï¼šé¦–æ¬¡ä½¿ç”¨éœ€è¦æˆæƒå½•éŸ³æƒé™
2. **HTTPS**ï¼šç”Ÿäº§ç¯å¢ƒéœ€è¦é…ç½® HTTPS
3. **è·¨åŸŸ**ï¼šåç«¯éœ€è¦é…ç½® CORS
4. **WebView è°ƒè¯•**ï¼šå¼€å¯ Chrome DevTools è¿œç¨‹è°ƒè¯•

## ğŸ“„ License

MIT

