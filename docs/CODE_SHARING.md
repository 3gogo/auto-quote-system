# ä»£ç å¤ç”¨ç­–ç•¥

æœ¬é¡¹ç›®é‡‡ç”¨**å…±äº«ä¸šåŠ¡é€»è¾‘å±‚**çš„æ–¹å¼å®ç°è·¨å¹³å°ä»£ç å¤ç”¨ã€‚

## ğŸ“Š æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å…±äº«ä¸šåŠ¡é€»è¾‘å±‚                            â”‚
â”‚  client/shared/                                             â”‚
â”‚  â”œâ”€â”€ api/          # API è°ƒç”¨å°è£…                            â”‚
â”‚  â”œâ”€â”€ types/        # TypeScript ç±»å‹å®šä¹‰                     â”‚
â”‚  â””â”€â”€ utils/        # é€šç”¨å·¥å…·å‡½æ•°                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¹³å°å…¼å®¹å±‚                               â”‚
â”‚  client/platform/                                           â”‚
â”‚  â”œâ”€â”€ interface.ts     # ç»Ÿä¸€æ¥å£å®šä¹‰                         â”‚
â”‚  â”œâ”€â”€ h5-adapter.ts    # H5/WebView é€‚é…å™¨                   â”‚
â”‚  â””â”€â”€ mp-adapter.*     # å°ç¨‹åºé€‚é…å™¨ï¼ˆé€šè¿‡ wrapperï¼‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¾®ä¿¡å°ç¨‹åº       â”‚    H5 Web ç«¯      â”‚   Android APP ç«¯     â”‚
â”‚   WXML/WXSS      â”‚    Vue 3         â”‚   WebView + JSBridge â”‚
â”‚   åŸç”Ÿ UI        â”‚    ç»Ÿä¸€ UI        â”‚   ç»Ÿä¸€ UI            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ å¤ç”¨ç­–ç•¥

### 1. å°ç¨‹åº vs H5/Android

| å±‚æ¬¡ | å°ç¨‹åº | H5/Android | å¤ç”¨æ–¹å¼ |
|------|-------|------------|---------|
| **API è°ƒç”¨** | shared-api.js | shared/api | âœ… é€»è¾‘ç›¸åŒï¼Œé€‚é…è¯·æ±‚å®ç° |
| **å·¥å…·å‡½æ•°** | shared-util.js | shared/utils | âœ… ç›´æ¥å¤ç”¨ |
| **ç±»å‹å®šä¹‰** | â€” | shared/types | TypeScript ä¸“ç”¨ |
| **UI ç»„ä»¶** | WXML/WXSS | Vue ç»„ä»¶ | âŒ åˆ†åˆ«å®ç° |
| **å½•éŸ³åŠŸèƒ½** | RecorderManager | MediaRecorder/JSBridge | âŒ å¹³å°å·®å¼‚å¤§ |
| **å­˜å‚¨** | wx.setStorageSync | localStorage | âŒ API ä¸åŒ |

### 2. H5 vs Android APP

| å±‚æ¬¡ | H5 æµè§ˆå™¨ | Android WebView | å¤ç”¨æ–¹å¼ |
|------|----------|----------------|---------|
| **UI** | Vue ç»„ä»¶ | åŠ è½½ H5 | âœ… 100% å¤ç”¨ |
| **ä¸šåŠ¡é€»è¾‘** | stores/api | åŠ è½½ H5 | âœ… 100% å¤ç”¨ |
| **å½•éŸ³** | MediaRecorder | JSBridge | ğŸ”„ é€šè¿‡é€‚é…å™¨ç»Ÿä¸€ |
| **æŒ¯åŠ¨** | navigator.vibrate | JSBridge | ğŸ”„ é€šè¿‡é€‚é…å™¨ç»Ÿä¸€ |

## ğŸ“ æ–‡ä»¶å¯¹åº”å…³ç³»

### å…±äº«ä¸šåŠ¡é€»è¾‘

| å…±äº«å±‚ (client/shared/) | å°ç¨‹åº (miniprogram/) | è¯´æ˜ |
|------------------------|---------------------|------|
| api/index.ts | utils/shared-api.js | API è°ƒç”¨å°è£… |
| utils/index.ts | utils/shared-util.js | å·¥å…·å‡½æ•° |
| types/index.ts | â€” | TypeScript ç±»å‹ |

### å¹³å°é€‚é…

| åŠŸèƒ½ | å°ç¨‹åºå®ç° | H5 å®ç° | Android å®ç° |
|------|----------|--------|-------------|
| HTTP è¯·æ±‚ | wx.request | fetch | ç”± H5 å¤„ç† |
| å½•éŸ³ | RecorderManager | MediaRecorder | JSBridge |
| TTS æ’­æ”¾ | InnerAudioContext | Audio | ç”± H5 å¤„ç† |
| æŒ¯åŠ¨ | wx.vibrateShort | navigator.vibrate | JSBridge |
| å­˜å‚¨ | wx.setStorageSync | localStorage | ç”± H5 å¤„ç† |

## ğŸ”§ åŒæ­¥å…±äº«ä»£ç 

å°ç¨‹åºæ— æ³•ç›´æ¥ import å¤–éƒ¨æ¨¡å—ï¼Œéœ€è¦æ‰‹åŠ¨åŒæ­¥ï¼š

```bash
# åŒæ­¥å…±äº«ä»£ç åˆ°å°ç¨‹åº
node scripts/sync-shared-code.js
```

## âš ï¸ å¾®ä¿¡å°ç¨‹åº web-view é™åˆ¶

è€ƒè™‘è¿‡åœ¨å°ç¨‹åºä¸­ä½¿ç”¨ web-view åŠ è½½ H5ï¼Œä½†æœ‰ä»¥ä¸‹é™åˆ¶ï¼š

1. **ä¸ªäººä¸»ä½“**ï¼šä¸ªäººå¼€å‘è€…ä¸èƒ½ä½¿ç”¨ web-view ç»„ä»¶
2. **ä¸šåŠ¡åŸŸå**ï¼šéœ€è¦ HTTPS + ICPå¤‡æ¡ˆ
3. **å…¨å±æ¨¡å¼**ï¼šæ— æ³•å åŠ åŸç”Ÿç»„ä»¶
4. **å½•éŸ³ API**ï¼šweb-view å†…æ— æ³•è°ƒç”¨ RecorderManager
5. **ä½“éªŒ**ï¼šå…¨å±åˆ‡æ¢ï¼Œè¿”å›é€»è¾‘å¤æ‚

### ç»“è®º

**æ ¸å¿ƒçš„è¯­éŸ³æŠ¥ä»·åŠŸèƒ½å¿…é¡»ä¿æŒå°ç¨‹åºåŸç”Ÿå®ç°**ï¼Œå› ä¸ºéœ€è¦ RecorderManagerã€‚
å…¶ä»–é¡µé¢ï¼ˆå¦‚äº¤æ˜“è®°å½•ï¼‰è™½ç„¶æŠ€æœ¯ä¸Šå¯ä»¥ç”¨ web-viewï¼Œä½†ï¼š
- å¢åŠ äº†é…ç½®å¤æ‚åº¦
- ç”¨æˆ·ä½“éªŒä¸ä¸€è‡´
- èŠ‚çœçš„ä»£ç é‡æœ‰é™

å› æ­¤ï¼Œæ¨èé‡‡ç”¨**å…±äº«ä¸šåŠ¡é€»è¾‘ + UI åˆ†åˆ«å®ç°**çš„æ–¹æ¡ˆã€‚

## ğŸ“ æœ€ä½³å®è·µ

1. **æ–°å¢ API è°ƒç”¨æ—¶**ï¼šå…ˆåœ¨ `client/shared/api/index.ts` æ·»åŠ ï¼Œå†åŒæ­¥åˆ°å°ç¨‹åº
2. **æ–°å¢å·¥å…·å‡½æ•°æ—¶**ï¼šå…ˆåœ¨ `client/shared/utils/index.ts` æ·»åŠ ï¼Œå†åŒæ­¥åˆ°å°ç¨‹åº
3. **ä¿®æ”¹ä¸šåŠ¡é€»è¾‘æ—¶**ï¼šä¿æŒä¸¤ç«¯é€»è¾‘ä¸€è‡´
4. **UI å·®å¼‚å¤„ç†**ï¼šåœ¨å„ç«¯çš„ UI å±‚å¤„ç†ï¼Œä¸è¦æ±¡æŸ“å…±äº«å±‚

## ğŸš€ æœªæ¥ä¼˜åŒ–

1. **uni-app è¿ç§»**ï¼šå¦‚æœéœ€è¦æ›´é«˜çš„å¤ç”¨åº¦ï¼Œå¯è€ƒè™‘è¿ç§»åˆ° uni-app
2. **æ„å»ºè‡ªåŠ¨åŒ–**ï¼šå°†åŒæ­¥è„šæœ¬é›†æˆåˆ° CI/CD
3. **ä»£ç ç”Ÿæˆ**ï¼šæ ¹æ® TypeScript ç±»å‹è‡ªåŠ¨ç”Ÿæˆå°ç¨‹åºç±»å‹æ³¨é‡Š

