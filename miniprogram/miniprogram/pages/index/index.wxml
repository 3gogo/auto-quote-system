<!--
  é¦–é¡µ - è¯­éŸ³æŠ¥ä»·ç•Œé¢
-->
<view class="container">
  <!-- ä»Šæ—¥ç»Ÿè®¡ -->
  <view class="stats-card">
    <view class="stats-item">
      <text class="stats-value">{{todayStats.orderCount}}</text>
      <text class="stats-label">ä»Šæ—¥è®¢å•</text>
    </view>
    <view class="stats-divider"></view>
    <view class="stats-item">
      <text class="stats-value amount">{{todayStats.totalAmount}}</text>
      <text class="stats-label">ä»Šæ—¥é”€å”®é¢</text>
    </view>
  </view>

  <!-- å¯¹è¯åŒºåŸŸ -->
  <view class="chat-area" id="message-list">
    <block wx:if="{{messages.length === 0}}">
      <view class="welcome-message">
        <image src="/images/voice-big.png" class="welcome-icon" mode="aspectFit"></image>
        <text class="welcome-text">æŒ‰ä½ä¸‹æ–¹æŒ‰é’®å¼€å§‹è¯­éŸ³æŠ¥ä»·</text>
        <text class="welcome-hint">ä¾‹å¦‚ï¼š"è€ç‹è¦5æ–¤çŒªè‚‰3æ–¤ç™½èœ"</text>
      </view>
    </block>
    
    <block wx:for="{{messages}}" wx:key="id">
      <view class="message {{item.role === 'user' ? 'message-user' : 'message-assistant'}}">
        <view class="message-bubble">
          <text>{{item.content}}</text>
        </view>
      </view>
    </block>
  </view>

  <!-- å½“å‰æŠ¥ä»·å¡ç‰‡ -->
  <view class="quote-card" wx:if="{{currentQuote}}">
    <view class="quote-header">
      <text class="quote-title">ğŸ“‹ æŠ¥ä»·å•</text>
      <text class="quote-customer" wx:if="{{currentQuote.customerName}}">
        å®¢æˆ·ï¼š{{currentQuote.customerName}}
      </text>
    </view>
    
    <view class="quote-items">
      <view class="quote-item" wx:for="{{currentQuote.items}}" wx:key="index">
        <view class="item-info">
          <text class="item-name">{{item.productName}}</text>
          <text class="item-qty">Ã—{{item.quantity}}{{item.unit}}</text>
        </view>
        <view class="item-price">
          <text class="price-unit">Â¥{{item.unitPrice}}/{{item.unit}}</text>
          <text class="price-total amount">{{item.totalPrice}}</text>
        </view>
      </view>
    </view>
    
    <view class="quote-footer">
      <view class="quote-total">
        <text>åˆè®¡ï¼š</text>
        <text class="total-amount amount">{{currentQuote.totalAmount}}</text>
      </view>
      <view class="quote-actions">
        <button class="btn-cancel" bindtap="cancelQuote">å–æ¶ˆ</button>
        <button class="btn-confirm" bindtap="confirmQuote">ç¡®è®¤</button>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œåŒº -->
  <view class="action-area">
    <!-- å½•éŸ³çŠ¶æ€æç¤º -->
    <view class="recording-status" wx:if="{{isRecording}}">
      <view class="wave-container {{waveAnimation ? 'animating' : ''}}">
        <view class="wave-bar"></view>
        <view class="wave-bar"></view>
        <view class="wave-bar"></view>
        <view class="wave-bar"></view>
        <view class="wave-bar"></view>
      </view>
      <text class="recording-time">{{recordingTime}}s</text>
      <text class="recording-hint">æ¾å¼€å‘é€ï¼Œä¸Šæ»‘å–æ¶ˆ</text>
    </view>

    <!-- å¤„ç†ä¸­çŠ¶æ€ -->
    <view class="processing-status" wx:if="{{isProcessing}}">
      <view class="loading-spinner"></view>
      <text>å¤„ç†ä¸­...</text>
    </view>

    <!-- å½•éŸ³æŒ‰é’® -->
    <view 
      class="record-btn {{isRecording ? 'recording' : ''}} {{isProcessing ? 'disabled' : ''}}"
      bindtouchstart="onRecordStart"
      bindtouchend="onRecordEnd"
      bindtouchcancel="onRecordCancel"
      catchtouchmove="onRecordCancel"
    >
      <image 
        src="{{isRecording ? '/images/voice-recording.png' : '/images/voice-btn.png'}}" 
        class="record-icon"
        mode="aspectFit"
      ></image>
      <text class="record-text">
        {{isRecording ? 'æ¾å¼€å‘é€' : 'æŒ‰ä½è¯´è¯'}}
      </text>
    </view>

    <!-- æ¸…ç©ºæŒ‰é’® -->
    <view class="clear-btn" bindtap="clearConversation" wx:if="{{messages.length > 0}}">
      <text>æ¸…ç©º</text>
    </view>
  </view>
</view>

